{% extends 'layouts/vertical.html' %}

{% load plans %}

{% block title %}{{ plan.name }} kaufen{% endblock %}

{% block left_column %}
    <h2>{{ plan.name }}</h2>
    <p class="description">{{ plan.description }}</p>
    <a href="{% url 'list_plans' %}">Alle Abonnements</a>

    {% for message in messages %}
        <p class="alert{% if message.tags %} {{ message.tags }}{% endif %}">{{ message }}</p>
    {% endfor %}


    <form id="purchase-form" action="{% url 'purchase' plan.slug %}" method="post">
        {% csrf_token %}

        <fieldset>
            <h3>Account</h3>
            {{ user_form.as_p }}
            <p class="alert info">
                Das Login erfolgt ohne Passwort, darum musst du auch keines angeben. Wenn du dich
                anmelden willst, senden wir dir eine E-Mail mit einem sicheren Login-Link.
            </p>
        </fieldset>

        <fieldset>
            <h3>Abonnement</h3>
            {{ address_form.as_p }}
        </fieldset>

        <fieldset>
            <h3>Preis</h3>

            {% if plan.price >= 0 %}
                <div class="price">
                    {% if plan.price == 0 %}
                        <span class="amount">Gratis</span>
                    {% else %}
                        <span class="amount">{{ plan.price }}</span> Franken
                    {% endif %}
                    /
                    {% humanize_months plan.duration %}
                </div>
            {% elif plan.min_price >= 0 %}
                <p>
                    Laufzeit:<br>
                    {% humanize_months plan.duration %}
                </p>
                {{ payment_form.as_p }}
            {% endif %}

            {# Displays info box if subscription potentially costs something. #}
            {% if not plan.price == 0 or plan.price < 0 and plan.min_price >= 0 %}
                <p class="alert info">
                    Wir unterstützen nur Zahlungen mittels Banküberweisung. Nach dem Kauf deines Abonnements,
                    schicken wir dir eine Rechnung. Sobald die Zahlung bei uns eingetroffen ist, aktivieren wir es.
                </p>
            {% endif %}
        </fieldset>

        <fieldset>
            {% if plan.price == 0 %}
                <input class="button black" type="submit" value="Abonnieren" />
            {% else %}
                <input class="button black" type="submit" value="Kaufen" />
            {% endif %}
        </fieldset>
    </form>
{% endblock %}

{% comment %}
{% block background_image_url %}{% endblock %}
{% endcomment %}

{% block right_column_alignment %}top{% endblock %}

{% block right_column %}
    <h3>Lorem ipsum</h3>
    <p>{% lorem %}</p>
{% endblock %}
