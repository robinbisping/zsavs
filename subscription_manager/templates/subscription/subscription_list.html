{% extends 'base.html' %}

{% block title %}Abonnements{% endblock %}

{% block description %}
    Verwalte deine Abos.
{% endblock %}

{% block content %}
    <div class="action-bar">
        <a class="button success" href="{% url 'plan_list' %}">Abo bestellen</a>
    </div>

    {% if subscriptions|length > 0 %}
        <ul class="list">
            {% for subscription in subscriptions %}
                <li>

                    <h3>{{ subscription.plan.name }}</h3>

                    {# Badges #}
                    <div>
                        {% if subscription.is_active %}
                            <span class="badge success">Aktiv</span>
                        {% else %}
                            {% if not subscription.is_canceled %}
                                <span class="badge danger">Inaktiv</span>
                            {% else %}
                                <span class="badge grey">Gekündigt</span>
                            {% endif %}
                        {% endif %}
                        {% if subscription.is_paid %}
                            <span class="badge success">Bezahlt</span>
                        {% else %}
                            <span class="badge danger">Nicht bezahlt</span>
                        {% endif %}
                    </div>

                    <p>
                        {{ subscription.full_name }}<br>
                        {{ subscription.address_line }}<br>
                        {% if subscription.additional_address_line %}
                            {{ subscription.additional_address_line }}<br>
                        {% endif %}
                        {{ subscription.postcode }} {{ subscription.town }}
                    </p>

                    {% if subscription.is_active %}
                        <p>
                            Gültig bis {{ subscription.end_date }}
                        </p>
                    {% endif %}

                    {# Actions #}
                    <ul class="actions">
                        {% if not subscription.is_paid %}
                            <li><em><a href="{% url 'subscription_detail' subscription.id %}">Offene Rechnung</a></em></li>
                        {% else %}
                            <li><a href="{% url 'subscription_detail' subscription.id %}">Zahlungsübersicht</a></li>
                        {% endif %}
                        {% if subscription.is_active %}
                            <li><a href="{% url 'subscription_update' subscription.id %}">Adresse ändern</a></li>
                            {% if subscription.expires_soon and not subscription.has_open_payments %}
                                <li><a href="{% url 'payment_create' subscription.id %}">Verlängern</a></li>
                            {% endif %}
                            {% if not subscription.has_open_payments %}
                                <li><a href="{% url 'subscription_cancel' subscription.id %}">Kündigen</a></li>
                            {% endif %}
                        {% endif %}
                    </ul>
                </li>
            {% endfor %}
        </ul>

    {% else %}

        <p class="message info">Du hast noch kein Abo.</p>

    {% endif %}
{% endblock %}