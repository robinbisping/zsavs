{% extends 'layouts/manager.html' %}

{% load plans %}

{% block title %}Abonnements{% endblock %}

{% block content %}
    {% for message in messages %}
        <p class="alert{% if message.tags %} {{ message.tags }}{% endif %}">{{ message }}</p>
    {% endfor %}

    <nav class="controls">
        <a href="{% url 'plan_list' %}" class="button success">Neues Abonnement</a>
    </nav>

    <table>
        <tr>
            <th>Typ</th>
            <th>Adresse</th>
            <th>Status</th>
            <th>Optionen</th>
        </tr>

        {% for subscription in subscriptions %}
            <tr>

                <td>
                    {% plan_name subscription.plan %}
                </td>

                <td>
                    <address>
                        {{ subscription.address_line_1 }}<br>
                        {% if subscription.address_line_2 %}
                            {{ subscription.address_line_2 }}<br>
                        {% endif %}
                        {{ subscription.postcode }} {{ subscription.city }}
                    </address>
                </td>

                <td>
                    {% if subscription.is_active %}
                        <span class="badge success">Gültig bis {{ subscription.end_date }}</span>
                    {% elif subscription.has_ended %}
                        <span class="badge danger">Am {{ subscription.end_date }} abgelaufen</span>
                    {% else %}
                        <span class="badge danger">Zahlung offen</span>
                    {% endif %}
                </td>

                <td>
                    {% if subscription.payment.is_paid %}
                        <a href="{% url 'subscription_update' subscription.id %}" class="button black">Bearbeiten</a>
                        <a href="{% url 'subscription_delete' subscription.id %}" class="button danger">Kündigen</a>
                    {% else %}
                        <a href="{% url 'subscription_detail' subscription.id %}" class="button success">Zahlungsdetails</a>
                    {% endif %}
                </td>

            </tr>
        {% empty %}
            <tr>
                <td>Du hast keine Abos.</td>
            </tr>
        {% endfor %}
    </table>
{% endblock %}