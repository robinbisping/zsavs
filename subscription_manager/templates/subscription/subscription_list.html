{% extends 'layouts/manager.html' %}

{% block title %}Abonnements{% endblock %}

{% block description %}
    Verwalte deine Abos.
{% endblock %}

{% block content %}
    <ul class="list">
        {% if subscriptions|length > 0 %}
            <p>
                <a class="button primary" href="{% url 'plan_list' %}">Neues Abonnement</a>
            </p>

            <div class="cards">
                {% for subscription in subscriptions %}
                    <li>
                        {% include 'includes/subscription.html' %}

                        <div class="status">
                            <h4>Status</h4>
                            {% if subscription.is_active %}
                                <span class="badge success">Aktiv</span>
                                <br>
                                Gültig bis {{ subscription.end_date }}
                            {% else %}
                                <span class="badge danger">Inaktiv</span>
                                {% if subscription.has_ended %}
                                    <br>
                                    Am {{ subscription.end_date }} abgelaufen
                                {% elif subscription.is_canceled %}
                                    <br>
                                    Am {{ subscription.canceled_at.date }} gekündigt
                                {% endif %}
                            {% endif %}
                        </div>

                        {% if subscription.has_open_payments %}
                            <div class="payment">
                                <h4>Zahlung</h4>
                                <a href="{% url 'subscription_detail' subscription.id %}">Offene Rechnung</a>
                            </div>
                        {% endif %}

                        {# Actions #}
                        {% if subscription.is_active %}
                            <ul class="actions">
                                <li><a href="{% url 'subscription_update' subscription.id %}">Adresse ändern</a></li>
                                {% if subscription.expires_soon and not subscription.has_open_payments %}
                                    <li><a href="{% url 'payment_create' subscription.id %}">Verlängern</a></li>
                                {% endif %}
                                {% if not subscription.has_open_payments %}
                                    <li><a href="{% url 'subscription_cancel' subscription.id %}">Kündigen</a></li>
                                {% endif %}
                            </ul>
                        {% endif %}
                    </li>
                {% endfor %}
            </div>
        {% else %}
            <p class="message info">Du hast noch kein Abo.</p>
            <a class="button success" href="{% url 'plan_list' %}">Abo bestellen</a>
        {% endif %}
    </ul>
{% endblock %}